---
layout: post
title: "Never assume! Stack iterators in Java"
guid: http://www.tigraine.at/2010/05/12/never-assume-stack-iterators-in-java/
postid: 856
---
<p>I spent almost 2 hours of debugging Java code yesterday due to one assumption that proved fatally wrong: I assumed a Stack, by definition a <a href="http://en.wikipedia.org/wiki/LIFO">LIFO</a> data structure would iterate over it’s elements from the top of the stack to the bottom. </p>  <p>So inserting 1, 2, 3 the resulting order when iterating through the stack should be 3, 2, 1.</p>  <p>Well, at least that’s what .NET does. Java is different. Look at the following Java code:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:ce41b27c-d44a-4660-a061-e7dbd1266df2" class="wlWriterEditableSmartContent"><pre name="code" class="java">
Stack&lt;Integer&gt; stack = new Stack&lt;Integer&gt;();
stack.push(1);
stack.push(2);
stack.push(3);

for(Integer i : stack) {
	System.out.println(i);
}
</pre></div>

<p>And this C#:</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:e36e607a-e4c1-4b13-adeb-c0b33588b3ab" class="wlWriterEditableSmartContent"><pre name="code" class="csharp">
var stack = new Stack&lt;int&gt;();
stack.Push(1);
stack.Push(2);
stack.Push(3);

foreach (var i in stack)
{
&#160;&#160;&#160;&#160;Console.WriteLine(i);
}
</pre></div>

<p>Well, they look exactly the same, but Java will return 1,2,3 while C# will honor the Stack’s special semantics and return 3,2,1. Great stuff isn’t it?</p>

<p>The workaround was quite simple, yet it had cost me 2 hours of my life trying to hunt a bug in my code, never thinking the bug could lie in a simple foreach iteration through the stack.. </p>

<p>Lesson learned: Never assume you know anything about data structure semantics unless you have checked that your assumptions are indeed true. Implementations differ and sometimes this will bite you.</p>

<p>Oh and did I mention that the way Java does it is simply wrong?</p>