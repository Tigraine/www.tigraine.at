---
layout: post
title: "Writing ELMAH Exceptions to Log4Net"
guid: http://www.tigraine.at/2009/11/22/writing-elmah-exceptions-to-log4net/
postid: 798
categories:
- net
- programmierung
---
<p>Yesterday a friend asked me if I know how to make ELMAH write exceptions to a Log4Net appender.    <br />My first idea was to write a custom ErrorLog that would do that, but that’s not really possible since ELMAH must be able to retrieve errors after the fact so they can be displayed in ELMAH’s web interface. </p>  <p>Well, turns out it’s even simpler and more obvious by simply subclassing an existing ErrorLog and hook into the Log method:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://www.tigraine.at/wp-content/uploads/2009/11/image.png" width="462" height="243" /> </p>  <p>Assuming you use the <tt>XmlFileErrorLog</tt> (you can use this method with all of them) you simply subclass it and put your call to Log4Net before the base.Log call:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:3a461e0c-b9b3-44d3-afeb-5cee090c5518" class="wlWriterEditableSmartContent"><pre name="code" class="csharp">
public class Log4NetErrorLog : XmlFileErrorLog
{
&#160;&#160;&#160;&#160;public Log4NetErrorLog(IDictionary config) : base(config)
&#160;&#160;&#160;&#160;{
&#160;&#160;&#160;&#160;}

&#160;&#160;&#160;&#160;public Log4NetErrorLog(string logPath) : base(logPath)
&#160;&#160;&#160;&#160;{
&#160;&#160;&#160;&#160;}

&#160;&#160;&#160;&#160;readonly ILog log = LogManager.GetLogger("bla");
&#160;&#160;&#160;&#160;public override string Log(Error error)
&#160;&#160;&#160;&#160;{
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;//Write whatever you want to Log4Net
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;log.Fatal("Exception logged through ELMAH: " + error.Message, error.Exception);
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return base.Log(error);
&#160;&#160;&#160;&#160;}
}
</pre></div>

<p>Now the only thing you have to do is change the errorLog line in your ELMAH configuration (found in web.config) to reference your new ErrorLog subclass:</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:7acc9b50-ccf0-4c2e-836c-6bda319deda2" class="wlWriterEditableSmartContent"><pre name="code" class="csharp">
&lt;elmah&gt;&#160;&#160;
&#160;&#160;&#160;&#160;&lt;errorLog type="MyAssembly.Log4NetErrorLog, MyAssembly" logPath="~/App_Data" /&gt;&#160;&#160;
&lt;/elmah&gt;
</pre></div>

<p>It will still log to XML, but also generate one entry per log to Log4Net. If you don’t want to save anything you can simply subclass the <tt>MemoryErrorLog</tt> class and set it’s size to 1. </p>