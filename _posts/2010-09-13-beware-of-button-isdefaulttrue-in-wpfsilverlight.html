---
layout: post
title: "Beware of &lt;Button IsDefault=&rdquo;True&rdquo;&gt; in WPF/Silverlight"
guid: http://www.tigraine.at/2010/09/13/beware-of-button-isdefaulttrue-in-wpfsilverlight/
postid: 919
categories:
- net
- programmierung
- wpf
---
<p>I’ve spent the better part of my weekend finding this bug and thought I’d share it in case someone else is having the problem. I’m building a WPF user interface with a NServiceBus backend and started noticing that sometimes changing data on the client didn’t generate UPDATE statements in my Database. I first assumed it had to do with my backend code, then I started digging through the various libraries I am using (NHibernate and NServiceBus) to find the problem. </p>  <p>After 2 days debugging through the backend code I finally found out that it’s the WPF application that sometimes sent wrong data. The scenario is quite simple:</p>  <p><a href="http://www.tigraine.at/wp-content/uploads/2010/09/image5.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://www.tigraine.at/wp-content/uploads/2010/09/image_thumb5.png" width="328" height="241" /></a></p>  <p>This very simple dialog uses a <a href="http://www.tigraine.at/2010/09/10/wpf-formatstring-and-its-localization-bugs/">StringFormat</a> to display the Price field. This prevents me from using any other binding than a <em>UpdateSourceTrigger=”OnLostFocus”</em> because otherwise it would reformat the field on every key-press. Rendering it unusable due to a jumping focus caret.&#160; </p>  <p>The issue was that upon hitting Save, sometimes the Save method was executed before the data was bound to the model, sometimes the other way around. I genuinely thought I had a race condition until I noticed one little thing: Since it’s a decimal field I usually fill those in by using the number pad. That also led to me hitting the Enter quite often without thinking about it, thus invoking the Save method while still having the focus on the Price Textbox. </p>  <p>If you set a Button to<em> IsDefault=”True”</em> and hit Enter the Command will be executed without triggering the OnLostFocus Databindings in your Textbox, making your code act on stale model data. The only way around this is to either use <em>UpdateSourceTrigger=”OnPropertyChanged”</em> (not always applicable) or remove the IsDefault attribute from your form. </p>  <p>I still believe this is a bug in WPF, but at least now I know about it and can avoid it.</p>