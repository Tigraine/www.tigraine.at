---
layout: post
title: "Powershell Functions are a different kind of beast!"
guid: http://www.tigraine.at/2010/09/22/powershell-functions-are-a-different-kind-of-beast/
postid: 940
categories:
- programmierung
---
<p>When you look at functions in C style language there are some things always true:</p>  <ol>   <li>Return always terminates the function </li>    <li>Return &lt;something&gt; returns a value/reference to the thing you return </li> </ol>  <p>Guess what: Powershell is no C style language! It may look like one with all the curly braces and the $ (reminding you of PHP) before variables. But it is no C language, rather it is a shell.. And shells seem to be working differently. </p>  <p>Care to hazard a guess what this will output?</p>  <blockquote>   <p><font face="Courier New">function Test        <br />{         <br />&#160;&#160;&#160; $a = &quot;Hello World&quot;         <br />&#160;&#160;&#160; &quot;Sorry World is not available&quot;         <br />&#160;&#160;&#160; return $a         <br />}</font></p>    <p><font face="Courier New">$output = Test        <br />Write-Host $output</font></p> </blockquote>  <p>If you’d expect it to return “Hello World” you are wrong. Actually the return value of the function Test is an array of 2 System.String:</p>  <blockquote>   <p>Sorry World is not available Hello World</p> </blockquote>  <p>Madness I know. But fact is that all things that get written to the “output” (like Write-Host) inside a function is part of the function output. You don’t need to use return.</p>  <p>This also means if you run commands like –match inside a function</p>  <blockquote>   <p>$v –match “regex”</p> </blockquote>  <p>–match will output true or false to the output. And thus your method output will include a True somewhere you don’t need it. Like this:</p>  <blockquote>   <p><font face="Courier New">function Test        <br />{         <br />&#160;&#160;&#160; $a = &quot;Hello World&quot;         <br />&#160;&#160;&#160; $a -match &quot;World&quot;         <br />&#160;&#160;&#160; return $matches[0]         <br />}</font></p>    <p><font face="Courier New">$output = Test        <br />Write-Host $output</font></p> </blockquote>  <p>Will output: <font face="Courier New">True World</font></p>  <p>You can avoid this behavior through redirecting the “output” to $null or by adding the [void] attribute like this:</p>  <blockquote>   <p>function Test      <br />{       <br />&#160;&#160;&#160; $a = &quot;Hello World&quot;       <br />&#160;&#160;&#160; $a -match &quot;World&quot; &gt; $null       <br />&#160;&#160;&#160; return $matches[0]       <br />}</p>    <p>$output = Test      <br />Write-Host $output</p> </blockquote>  <p>I never thought I’d have to revisit the workings of a return statement again, but obviously there is always the possibility for someone to come along and teach me something new. This person btw is Keith Hill who wrote an excellent article on <a href="http://keithhill.spaces.live.com/Blog/cns!5A8D2641E0963A97!811.entry">Powershell Output</a> that sheds some light on this topic and does a far better job at explaining it than I can possibly do.</p>