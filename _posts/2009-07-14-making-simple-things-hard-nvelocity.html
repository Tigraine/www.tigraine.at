---
layout: post
title: "Making simple things hard: NVelocity"
guid: http://www.tigraine.at/2009/07/14/making-simple-things-hard-nvelocity/
postid: 629
categories:
- net
- castle
- programmierung
---
<p>I was pretty done with the world after spending almost 2 days with xhtml/css coding for the new iC-Website. Turns out the programming gods want to teach me a lesson. Look at my Google Search log:</p>  <p><a href="http://www.tigraine.at/wp-content/uploads/2009/07/image7.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.tigraine.at/wp-content/uploads/2009/07/image-thumb4.png" width="519" height="293" /></a> </p>  <p>What you see here is me spending almost 45 minutes on formatting a date!</p>  <p>I need to take the date and split it into 3 parts so I can stick it into the following markup:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:2c29e5ae-00ca-4194-b7d8-923eff75798d" class="wlWriterEditableSmartContent"><pre name="code" class="xml">
&lt;div class="date"&gt;
&#160;&#160;&#160;&#160;&lt;span class="day"&gt;$day&lt;/span&gt;&lt;span class="month"&gt;$month&lt;/span&gt;
&#160;&#160;&#160;&#160;&lt;hr /&gt;
&#160;&#160;&#160;&#160;&lt;span class="year"&gt;$year&lt;/span&gt;
&lt;/div&gt;
</pre></div>

<p>I thought, hey that should be really simple, just call DateTime.ToString() and all will be well. And because it was so obvious I tried to create a macro to keep my viewcode clean. The result was:</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:2c3e4e68-6d68-4cb4-af5c-6ca32e96324e" class="wlWriterEditableSmartContent"><pre name="code" class="xml">
#macro ( dateBox $currentDate )
#set ($day = $currentDate.Day.ToString("00") )
#set ($month = $currentDate.Month.ToString("00") )
#set ($year = $currentDate.ToString("yy") )
&lt;div class="date"&gt;
&#160;&#160;&#160;&#160;&lt;span class="day"&gt;$day&lt;/span&gt;&lt;span class="month"&gt;$month&lt;/span&gt;
&#160;&#160;&#160;&#160;&lt;hr /&gt;
&#160;&#160;&#160;&#160;&lt;span class="year"&gt;$year&lt;/span&gt;
&lt;/div&gt;
#end
</pre></div>

<p>I still have no explanation why passing a DateTime into the macro isn’t working. Maybe because calling macros in NV isn’t the same as calling a CLR method. So I had to abandon the macro idea and just code it the way it is. </p>

<p>Now what really pissed me off to the point where I almost considered using <a href="http://www.aspview.com/">ASPView</a> as a view engine was that I spent almost 45 minutes with this for one simple reason: NVelocity won’t report errors as long as they don’t break the parser.</p>

<p>Perfect example:</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:1cda8931-6c09-4599-aaa4-59f5e9f9ea9e" class="wlWriterEditableSmartContent"><pre name="code" class="xml">
$DateTime.Now.Format("dd MM yyyy")
</pre></div>

<p>Will just result in a <em>“$DateTime.Now.Format(&quot;dd MM yyyy&quot;)”</em> output, for no apparent reason other than the fact that there is no Format() method on the DateTime. Clearly my bad, I’m stupid and far too dependent on IntelliSense, but if NV isn’t telling me how I screwed up it’s really hard to find the mistake. Especially without syntax highlighting and intellisense DateTime.Format(…) looks perfectly reasonable at first. </p>

<p>Finally I ended up with this:</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:2e6d557b-b705-4c34-b5ad-8606cf99c7de:af6137ce-581b-4127-92a4-5691ad30b33e" class="wlWriterEditableSmartContent"><pre name="code" class="xml">
#set ($day = $currentDate.ToString("dd") )
#set ($month = $currentDate.ToString("MM") )
#set ($year = $currentDate.ToString("yy") )
&lt;div class="date"&gt;
&#160;&#160;&#160;&#160;&lt;span class="day"&gt;$day&lt;/span&gt;&lt;span class="month"&gt;$month&lt;/span&gt;
&#160;&#160;&#160;&#160;&lt;hr /&gt;
&#160;&#160;&#160;&#160;&lt;span class="year"&gt;$year&lt;/span&gt;
&lt;/div&gt;

</pre></div>