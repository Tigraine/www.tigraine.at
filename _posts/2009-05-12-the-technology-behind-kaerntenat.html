---
layout: post
title: "The technology behind kaernten.at"
guid: http://www.tigraine.at/2009/05/12/the-technology-behind-kaerntenat/
postid: 515
categories:
- net
- job
---
<p>During the last few months I have been the technical architect behind the development of a new platform for tourism in Carinthia. While I have already discussed some of the inner workings of the project during that time, I thought it might be interesting to let you in on a deeper look at the application architecture behind the site: <a href="http://www.kaernten.at">www.kaernten.at</a>.</p>  <p><strong>Quick facts:</strong></p>  <p>The site is built using ASP.NET MVC (since Beta 3) being hosted by IIS6 on a MSSQL 2005 database.</p>  <p>The whole thing is glued together by <a href="http://www.castleproject.org/container/index.html">Castle Windsor</a> and DynamicProxy2 while tests are all run through <a href="http://www.codeplex.com/xunit">xUnit</a> and <a href="http://ayende.com/projects/rhino-mocks.aspx">Rhino.Mocks</a>. The error reporting is done through <a href="http://www.tigraine.at/2009/04/20/elmah-aspnet-error-logging-on-mvc/">ELMAH</a>.</p>  <p><strong>General Architecture</strong></p>  <p>There are three layers to the application:</p>  <p><img title="image" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="289" alt="image" src="http://www.tigraine.at/wp-content/uploads/2009/05/image.png" width="514" border="0" /> </p>  <p>The Web tier was the actual ASP.NET MVC Site and this was the part I was least involved in. The Controllers use the Services layer to retrieve relevant information and then passes it on to the View.</p>  <p>I knew from previous projects that the web tier is the first place that is going to get torn apart by weird customer requests and other very ui-driven changes, so the general goal of the services layer wasn’t only to present data to the web, but to provide services to manipulate that data for presentation. So the Services layer is mostly&#160; about filtering/sorting/querying data from the database, since there is no common logic to the madness of presentation requirements.</p>  <p>The database tier is actually split across two tiers, the Sql tier and the Proxy tier. (I’ll cover the Proxy in a future post in more detail.) Most notable the whole database retrieval is done through Linq to&#160; Sql. </p>  <p>Also everything in the system is dependency injected, there is not one call to new() anywhere in the system, except for the construction of data objects (that in my design aren’t allowed to have services on them).</p>  <p><strong>Query logic</strong></p>  <p>The whole site is based on the concept of <strong>When </strong>youre visiting? <strong>What</strong> are you interested in? And <strong>Where </strong>would that be?</p>  <p>So, there is not a typical tree of categories with articles to browse through, but rather is the whole content of the site the result of all articles that match your criteria. Therefore every article in the system has a list of tags it’s connected to (when&#160; and what both are just tags). </p>  <p>Now, one of the main challenges for all of the team (involving the customer) was to really define that query logic, and we changed it about 10 times during development, and I’m sure it will change even more in the future.</p>  <p>So, although it might have been possible to do all querying/sorting/filtering with Sql, the Sql code became utterly unreadable and sometimes involved n subselects.    <br />I gave up on the Sql pretty early on since it was just too un-maintainable and felt too restraining.     <br />My solution to this was to load all articles into memory and filter/sort them from there. This then enabled me to easily implement queries like this one:     <br />All articles that are tagged a,b,c AND at least one of d,e,f (or more formally: (a &amp;&amp; b &amp;&amp; c) &amp;&amp; (d || e || f))</p>  <p>And that’s about it for the general picture right now. I’m planning on posting more on the technology behind <a href="http://www.kaernten.at">www.kaernten.at</a> over the next couple of days.</p>